# نظام رسوم المنصة - GamesHub

## نظرة عامة
تم تطبيق نظام رسوم المنصة بنسبة 10% على جميع الصفقات المكتملة. يتم خصم هذه الرسوم من البائع عند إتمام الصفقة.

## الملفات المحدثة

### 1. ملفات PHP (Backend)
- **`api/release_funds.php`** - تحديث عملية تحرير الأموال لتشمل خصم 10%
- **`api/admin_deals.php`** - تحديث إدارة الصفقات لتشمل نظام الرسوم
- **`api/fund_deal.php`** - تحديث تأكيد الصفقات لتشمل الرسوم
- **`api/platform_fees_stats.php`** - إحصائيات رسوم المنصة (جديد)

### 2. ملفات HTML (Frontend)
- **`add-account.html`** - إضافة واجهة عرض الرسوم للبائع
- **`admin-fees.html`** - صفحة إحصائيات رسوم المنصة (جديد)

### 3. ملفات قاعدة البيانات
- **`api/update_fee_system.sql`** - تحديثات قاعدة البيانات (جديد)

## الميزات الجديدة

### 1. واجهة عرض الرسوم للبائع
- عرض تفصيلي للرسوم قبل إضافة الحساب
- حساب تلقائي للرسوم عند تغيير السعر
- رسائل تنبيه واضحة عن الرسوم

### 2. نظام الرسوم في Backend
- خصم 10% من كل صفقة مكتملة
- تسجيل تفصيلي للرسوم في `financial_logs`
- حفظ تفاصيل الرسوم في جدول `deals`

### 3. صفحة إحصائيات الإدارة
- عرض إجمالي الرسوم المحصلة
- إحصائيات شهرية
- قائمة بآخر الصفقات مع تفاصيل الرسوم

## كيفية العمل

### 1. عند إضافة حساب جديد
1. البائع يدخل السعر في صفحة `add-account.html`
2. النظام يعرض تلقائياً:
   - سعر الحساب
   - رسوم المنصة (10%)
   - المبلغ الذي سيحصل عليه البائع
3. البائع يوافق على الشروط ويضيف الحساب

### 2. عند إتمام الصفقة
1. المشتري يدفع المبلغ الكامل
2. البائع يسلم الحساب
3. عند تحرير الأموال:
   - يتم خصم 10% كرسوم للمنصة
   - البائع يحصل على 90% من المبلغ
   - الرسوم تذهب لحساب النظام/الإدارة

## قاعدة البيانات

### حقول جديدة في جدول `deals`
```sql
platform_fee DECIMAL(10,2) DEFAULT 0.00
seller_amount DECIMAL(10,2) DEFAULT 0.00  
fee_percentage DECIMAL(5,2) DEFAULT 10.00
```

### جدول جديد `platform_fees`
```sql
CREATE TABLE platform_fees (
    id INT AUTO_INCREMENT PRIMARY KEY,
    deal_id INT NOT NULL,
    fee_amount DECIMAL(10,2) NOT NULL,
    fee_percentage DECIMAL(5,2) NOT NULL,
    seller_amount DECIMAL(10,2) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## التثبيت

1. تشغيل ملف SQL:
```bash
mysql -u username -p database_name < api/update_fee_system.sql
```

2. التأكد من وجود مستخدم نظام أو إداري في قاعدة البيانات

3. اختبار النظام:
   - إضافة حساب جديد
   - بدء صفقة
   - إتمام الصفقة والتحقق من الرسوم

## الأمان

- جميع العمليات المالية محمية بـ transactions
- التحقق من صلاحيات المستخدمين
- تسجيل مفصل لجميع المعاملات
- رسائل خطأ واضحة

## الدعم

لأي مشاكل أو استفسارات، يرجى مراجعة:
- ملفات السجلات في `debug.log`
- جدول `financial_logs` في قاعدة البيانات
- صفحة إحصائيات الرسوم في `admin-fees.html`
