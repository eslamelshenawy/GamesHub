<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-900 text-white p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©</h1>

        <div class="bg-gray-800 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">ğŸ“‹ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª</h2>

            <div class="space-y-4">
                <div class="bg-gray-700 p-4 rounded">
                    <h3 class="font-bold mb-2">1ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Session Check (ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©)</h3>
                    <p class="text-sm text-gray-300 mb-3">Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠÙØ­Øµ Ø§Ù„Ø¬Ù„Ø³Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©</p>
                    <button onclick="manualSessionCheck()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
                        ÙØ­Øµ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø¢Ù†
                    </button>
                </div>

                <div class="bg-gray-700 p-4 rounded">
                    <h3 class="font-bold mb-2">2ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± API Request Ù…Ø¹ Session Ù…Ù†ØªÙ‡ÙŠØ©</h3>
                    <p class="text-sm text-gray-300 mb-3">Ù…Ø­Ø§ÙƒØ§Ø© request ÙŠØ±Ø¬Ø¹ 401 Unauthorized</p>
                    <button onclick="testExpiredSession()" class="bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded">
                        Ø§Ø®ØªØ¨Ø§Ø± Session Ù…Ù†ØªÙ‡ÙŠØ©
                    </button>
                </div>

                <div class="bg-gray-700 p-4 rounded">
                    <h3 class="font-bold mb-2">3ï¸âƒ£ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø© (Logout)</h3>
                    <p class="text-sm text-gray-300 mb-3">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø­Ù‚ÙŠÙ‚ÙŠ Ø«Ù… ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
                    <button onclick="actualLogout()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded">
                        ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
                    </button>
                </div>
            </div>
        </div>

        <div class="bg-gray-800 rounded-lg p-6">
            <h2 class="text-xl font-bold mb-4">ğŸ“Š Logs</h2>
            <div id="logs" class="bg-black p-4 rounded font-mono text-sm h-64 overflow-y-auto">
                <div class="text-green-400">ğŸŸ¢ System Ready</div>
            </div>
            <button onclick="clearLogs()" class="mt-4 bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded text-sm">
                Ù…Ø³Ø­ Logs
            </button>
        </div>
    </div>

    <!-- Session Manager Script -->
    <script src="js/session-manager.js"></script>
    <script src="js/ban-check.js"></script>

    <script>
        function log(message, type = 'info') {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString('ar-EG');
            const color = {
                'info': 'text-blue-400',
                'success': 'text-green-400',
                'error': 'text-red-400',
                'warning': 'text-yellow-400'
            }[type] || 'text-gray-400';

            const div = document.createElement('div');
            div.className = color;
            div.textContent = `[${timestamp}] ${message}`;
            logs.appendChild(div);
            logs.scrollTop = logs.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '<div class="text-green-400">ğŸŸ¢ Logs Cleared</div>';
        }

        // 1. ÙØ­Øµ Ø§Ù„Ø¬Ù„Ø³Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹
        async function manualSessionCheck() {
            log('ğŸ” ÙØ­Øµ Ø§Ù„Ø¬Ù„Ø³Ø©...', 'info');

            try {
                const response = await fetch('/api/api/check_login.php', {
                    method: 'GET',
                    credentials: 'include'
                });

                log(`ğŸ“¡ Response Status: ${response.status}`, 'info');

                const text = await response.text();

                try {
                    const data = JSON.parse(text);
                    if (data.logged_in) {
                        log(`âœ… Ø§Ù„Ø¬Ù„Ø³Ø© Ù†Ø´Ø·Ø© - User ID: ${data.user_id}`, 'success');
                    } else {
                        log('âŒ Ø§Ù„Ø¬Ù„Ø³Ø© Ù…Ù†ØªÙ‡ÙŠØ©', 'error');
                    }
                } catch (e) {
                    log('âš ï¸ Response ØºÙŠØ± JSON - Ø§Ù„Ø¬Ù„Ø³Ø© Ù…Ù†ØªÙ‡ÙŠØ©', 'warning');
                }
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
            }
        }

        // 2. Ø§Ø®ØªØ¨Ø§Ø± Session Ù…Ù†ØªÙ‡ÙŠØ© (Ù…Ø­Ø§ÙƒØ§Ø© 401)
        async function testExpiredSession() {
            log('ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± session Ù…Ù†ØªÙ‡ÙŠØ©...', 'warning');

            // Ø³Ù†Ø¬Ø±Ø¨ Ù†Ø·Ù„Ø¨ API Ù…Ø­Ù…ÙŠ Ø¨Ø¯ÙˆÙ† session
            try {
                const response = await fetch('/api/api/admin_deals.php?action=get_pending_deals', {
                    method: 'GET',
                    credentials: 'include'
                });

                log(`ğŸ“¡ Response Status: ${response.status}`, 'info');

                if (response.status === 401 || response.status === 403) {
                    log('ğŸ¯ ØªÙ… Ø§ÙƒØªØ´Ø§Ù Session Ù…Ù†ØªÙ‡ÙŠØ©! Ø§Ù„Ù†Ø¸Ø§Ù… Ø³ÙŠØªÙˆÙ„Ù‰ Ø§Ù„Ø£Ù…Ø±...', 'warning');
                } else {
                    log(`âœ… Request Ù†Ø§Ø¬Ø­ - Status: ${response.status}`, 'success');
                }
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
            }
        }

        // 3. ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø­Ù‚ÙŠÙ‚ÙŠ
        async function actualLogout() {
            log('ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬...', 'warning');

            try {
                const response = await fetch('/api/api/logout.php', {
                    method: 'POST',
                    credentials: 'include'
                });

                const data = await response.json();
                log(`âœ… ${data.message || 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬'}`, 'success');

                // Ø§Ù„Ø¢Ù† Ù†ÙØ­Øµ Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ø¹Ø¯ 2 Ø«Ø§Ù†ÙŠØ©
                setTimeout(() => {
                    log('ğŸ” ÙØ­Øµ Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ø¹Ø¯ Logout...', 'info');
                    manualSessionCheck();
                }, 2000);
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
            }
        }

        // Log initial state
        log('âœ… Session Manager Ù…Ø­Ù…Ù„', 'success');
        log('âœ… Ban Checker Ù…Ø­Ù…Ù„', 'success');
        log('â„¹ï¸ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠÙØ­Øµ Ø§Ù„Ø¬Ù„Ø³Ø© ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹', 'info');
    </script>
</body>
</html>
