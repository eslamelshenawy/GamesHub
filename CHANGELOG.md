# ุณุฌู ุงูุชุบููุฑุงุช - ุฅุตูุงุญุงุช ุดุงููุฉ ูููููุน
## ๐ ุงูุชุงุฑูุฎ: 2025-10-10

---

## ๐ ููุฎุต ุงูุชุบููุฑุงุช

ุชู ุฅุฌุฑุงุก ุฅุตูุงุญุงุช ุดุงููุฉ ููุดุงูู ูุณุงุฑุงุช APIุ ุฃุฒุฑุงุฑ ุชุณุฌูู ุงูุฏุฎููุ ุงูุฏุฑุฏุดุฉุ ููุงุนุฏุฉ ุงูุจูุงูุงุช.

---

## โ ุงููุดุงูู ุงูุชู ุชู ุญููุง

### 1๏ธโฃ ูุดููุฉ ุธููุฑ ุฃุฒุฑุงุฑ ุชุณุฌูู ุงูุฏุฎูู ุฑุบู ุชุณุฌูู ุงูุฏุฎูู
**ุงูููู:** `index.html`

**ุงููุดููุฉ:**
- ูุงูุช ุฃุฒุฑุงุฑ "ุชุณุฌูู ุฏุฎูู" ุชุธูุฑ ุญุชู ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู
- ูุณุงุฑุงุช API ุฎุงุทุฆุฉ ุชุณุจุจ ุฎุทุฃ 404
- CSS classes ุจู `!important` ุชููุน JavaScript ูู ุงูุชุญูู

**ุงูุญู:**
```javascript
// ูุจู ุงูุฅุตูุงุญ
fetch('/api/check_login.php')  // โ ุฎุทุฃ 404

// ุจุนุฏ ุงูุฅุตูุงุญ
fetch('api/check_login.php')   // โ ูุนูู ุจูุฌุงุญ
```

**ุงูุชุบููุฑุงุช:**
- โ ุฅุฒุงูุฉ `/` ูู ุจุฏุงูุฉ ูุณุงุฑุงุช API (3 ููุงุถุน)
- โ ุชุญููู ูู CSS classes ุฅูู `style.display` ูุจุงุดุฑ
- โ ุฅุถุงูุฉ logging ููุชุชุจุน

**ุงูุฃุณุทุฑ ุงููุนุฏูุฉ:** 51-481

---

### 2๏ธโฃ ุฅุตูุงุญ ูุณุงุฑุงุช API ูู Sidebar
**ุงูููู:** `js/sidebar.js`

**ุงููุดููุฉ:**
- ููุณ ูุดููุฉ ุงููุณุงุฑุงุช ูู ุงูู sidebar

**ุงูุญู:**
```javascript
// ุชู ุชุตุญูุญ 3 ููุงุถุน:
// ุงูุณุทุฑ 44, 76, 164

// ูุจู: fetch('/api/check_login.php')
// ุจุนุฏ: fetch('api/check_login.php')
```

---

### 3๏ธโฃ ุฅุตูุงุญ ุญุงูุฉ ุงูุงุชุตุงู (Online Status)
**ุงูููู:** `js/online-status.js`

**ุงูุชุบููุฑ:**
```javascript
// ุงูุณุทุฑ 6
const response = await fetch('api/check_login.php', {
    method: 'GET',
    credentials: 'include'
});
```

---

### 4๏ธโฃ ุฅุตูุงุญ ููุญุฉ ุงูุฅุฏุงุฑุฉ
**ุงูููู:** `js/admin-dashboard.js`

**ุงูุชุบููุฑุงุช:**
```javascript
// ุงูุณุทุฑ 1501
fetch('api/ban_user.php', ...)     // ุจุฏูุงู ูู '/api/ban_user.php'

// ุงูุณุทุฑ 1538
fetch('api/unban_user.php', ...)   // ุจุฏูุงู ูู '/api/unban_user.php'

// ุงูุณุทุฑ 1575
fetch('api/ban_user.php', ...)
```

---

### 5๏ธโฃ ุฅุตูุงุญ ุฎุทุฃ 500 ูู ุงููุญุงุฏุซุงุช ุงูุฅุฏุงุฑูุฉ
**ุงููุดููุฉ:**
```
GET http://localhost/api/api/get_user_admin_chats.php 500 (Internal Server Error)
```

**ุงูุณุจุจ:** ุฌุฏูู `admin_chat_reads` ููููุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุงูุญู:**

#### ููู ุฌุฏูุฏ: `api/create_admin_chat_reads_table.php`
ููุดุฆ ุฌุฏูู admin_chat_reads ุจุงููููู ุงูุชุงูู:
```sql
CREATE TABLE IF NOT EXISTS `admin_chat_reads` (
    `id` INT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
    `chat_id` INT(11) NOT NULL,
    `user_id` INT(11) NOT NULL,
    `last_read_at` TIMESTAMP NULL DEFAULT NULL,
    `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `updated_at` TIMESTAMP NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY `unique_chat_user` (`chat_id`, `user_id`),
    KEY `idx_chat_id` (`chat_id`),
    KEY `idx_user_id` (`user_id`),
    CONSTRAINT `fk_admin_chat_reads_chat` FOREIGN KEY (`chat_id`)
        REFERENCES `admin_chats` (`id`) ON DELETE CASCADE,
    CONSTRAINT `fk_admin_chat_reads_user` FOREIGN KEY (`user_id`)
        REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

#### ููู ุฌุฏูุฏ: `api/check_admin_tables.php`
ููุชุญูู ูู ูุฌูุฏ ุฌุฏุงูู ุงูุฅุฏุงุฑุฉ ููุฑุงุฌุนุฉ ูููููุง

**ุงูุงุณุชุฎุฏุงู:**
```
http://localhost/api/api/create_admin_chat_reads_table.php
http://localhost/api/api/check_admin_tables.php
```

---

### 6๏ธโฃ ุฅุตูุงุญ ุชุญููู ุจูุงูุงุช ุงูุตููุงุช
**ุงูููู:** `js/massage.js`

**ุงููุดููุฉ:**
```javascript
fetch(`get_active_deal.php?conversation_id=${conversationId}`)  // โ ุฎุทุฃ 404
```

**ุงูุญู:**
```javascript
// ุงูุณุทุฑ 1512
fetch(`api/get_active_deal.php?conversation_id=${conversationId}`)  // โ
```

---

### 7๏ธโฃ ุฅุตูุงุญ ุฅุฑุณุงู ุงูุตูุฑ ูุงููููุงุช ูู ุงูุฏุฑุฏุดุฉ
**ุงูููู:** `messages.php`

**ุงููุดููุฉ:**
- ุญูู `file-input` ูุงู **ุฎุงุฑุฌ** ุงููููุฐุฌ `<form>`
- ุนูุฏ ุงูุถุบุท ุนูู ุฒุฑ ุงูุฅุฑุณุงูุ ุงูููู ูุง ููุฑุณู

**ุงูุญู:**
```html
<!-- ูุจู ุงูุฅุตูุงุญ -->
<input id="file-input" />  <!-- ุฎุงุฑุฌ ุงููููุฐุฌ โ -->
<form id="message-form">
  <input id="message-input" />
  <button type="submit" />
</form>

<!-- ุจุนุฏ ุงูุฅุตูุงุญ -->
<form id="message-form">
  <input id="file-input" />  <!-- ุฏุงุฎู ุงููููุฐุฌ โ -->
  <input id="message-input" />
  <button type="submit" />
</form>
```

**ุงูุฃุณุทุฑ ุงููุนุฏูุฉ:** 258-270

---

### 8๏ธโฃ ุฅุถุงูุฉ ุฃุฏุงุฉ ุงุฎุชุจุงุฑ ูููุญุงุฏุซุงุช
**ููู ุฌุฏูุฏ:** `api/test_add_conversation.php`

**ุงูุบุฑุถ:**
- ุฅูุดุงุก ูุญุงุฏุซุฉ ุชุฌุฑูุจูุฉ ููุงุฎุชุจุงุฑ
- ูุถูู ุฑุณุงูุฉ ุชููุงุฆูุฉ ุจููู ูุจูู ุฃูู ูุณุชุฎุฏู

**ุงูุงุณุชุฎุฏุงู:**
```
http://localhost/api/api/test_add_conversation.php
```

**ุงููุชูุฌุฉ:**
```json
{
  "success": true,
  "message": "ุชู ุฅูุดุงุก ูุญุงุฏุซุฉ ุชุฌุฑูุจูุฉ",
  "other_user_id": 2,
  "other_user_name": "ุฃุญูุฏ",
  "conversation_link": "messages.php?user_id=2"
}
```

---

## ๐ ูุงุฆูุฉ ุงููููุงุช ุงููุนุฏูุฉ

### ูููุงุช ุชู ุชุนุฏูููุง:
1. โ๏ธ `index.html` - ุฅุตูุงุญ ุฃุฒุฑุงุฑ ุชุณุฌูู ุงูุฏุฎูู ููุณุงุฑุงุช API
2. โ๏ธ `js/sidebar.js` - ุฅุตูุงุญ ูุณุงุฑุงุช API (3 ููุงุถุน)
3. โ๏ธ `js/online-status.js` - ุฅุตูุงุญ ูุณุงุฑ check_login
4. โ๏ธ `js/admin-dashboard.js` - ุฅุตูุงุญ ูุณุงุฑุงุช ban/unban (3 ููุงุถุน)
5. โ๏ธ `js/massage.js` - ุฅุตูุงุญ ูุณุงุฑ get_active_deal
6. โ๏ธ `messages.php` - ุฅุตูุงุญ ูููู ูููุฐุฌ ุงูุฑุณุงุฆู

### ูููุงุช ุชู ุฅูุดุงุคูุง:
7. โ `api/create_admin_chat_reads_table.php` - ุฅูุดุงุก ุฌุฏูู admin_chat_reads
8. โ `api/check_admin_tables.php` - ุงูุชุญูู ูู ุฌุฏุงูู ุงูุฅุฏุงุฑุฉ
9. โ `api/test_add_conversation.php` - ุฃุฏุงุฉ ุงุฎุชุจุงุฑ ุงููุญุงุฏุซุงุช
10. โ `CHANGELOG.md` - ูุฐุง ุงูููู (ุณุฌู ุงูุชุบููุฑุงุช)

---

## ๐ ุดุฑุญ ุงูุฑูุงุจุท ุงููููุฉ

### ๐ ุงูุตูุญุงุช ุงูุฑุฆูุณูุฉ:
| ุงูุฑุงุจุท | ุงููุตู |
|--------|-------|
| `http://localhost/api/` | ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ |
| `http://localhost/api/index.html` | ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ (ุตุฑูุญ) |
| `http://localhost/api/login.html` | ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู |
| `http://localhost/api/messages.php` | ุตูุญุฉ ุงูุฑุณุงุฆู ูุงูุฏุฑุฏุดุฉ |
| `http://localhost/api/admin-dashboard.html` | ููุญุฉ ุชุญูู ุงูุฅุฏุงุฑุฉ |

### ๐ฌ ุฑูุงุจุท ุงูุฏุฑุฏุดุฉ:
| ุงูุฑุงุจุท | ุงููุตู |
|--------|-------|
| `messages.php` | ูุงุฆูุฉ ุฌููุน ุงููุญุงุฏุซุงุช |
| `messages.php?user_id=5` | ูุชุญ ูุญุงุฏุซุฉ ูุน ูุณุชุฎุฏู ูุนูู (ID=5) |
| `messages.php?seller_id=5` | ููุณ ุงูุฃุนูู (ุงุณู ุจุฏูู ูููุนุงูู) |
| `messages.php?conversation_id=10` | ูุชุญ ูุญุงุฏุซุฉ ุจุงุณุชุฎุฏุงู ID ุงููุญุงุฏุซุฉ |

### ๐ง ุฑูุงุจุท API ููุงุฎุชุจุงุฑ:
| ุงูุฑุงุจุท | ุงููุตู | ุงูุทุฑููุฉ |
|--------|-------|---------|
| `api/check_login.php` | ุงูุชุญูู ูู ุญุงูุฉ ุชุณุฌูู ุงูุฏุฎูู | GET |
| `api/get_conversations.php` | ุฌูุจ ูุงุฆูุฉ ุงููุญุงุฏุซุงุช | GET |
| `api/get_messages.php?user_id=5` | ุฌูุจ ุฑุณุงุฆู ูุญุงุฏุซุฉ ูุนููุฉ | GET |
| `api/send_message.php` | ุฅุฑุณุงู ุฑุณุงูุฉ ูุตูุฉ | POST |
| `api/send_file.php` | ุฅุฑุณุงู ููู/ุตูุฑุฉ | POST |
| `api/test_add_conversation.php` | ุฅูุดุงุก ูุญุงุฏุซุฉ ุชุฌุฑูุจูุฉ | GET |

### ๐๏ธ ุฑูุงุจุท ูุงุนุฏุฉ ุงูุจูุงูุงุช:
| ุงูุฑุงุจุท | ุงููุตู |
|--------|-------|
| `api/check_admin_tables.php` | ุงูุชุญูู ูู ุฌุฏุงูู ุงูุฅุฏุงุฑุฉ |
| `api/create_admin_chat_reads_table.php` | ุฅูุดุงุก ุฌุฏูู admin_chat_reads |

---

## ๐ฏ ููููุฉ ุงูุงุฎุชุจุงุฑ

### 1. ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู:
```bash
# ุงูุชุญ ุงููุชุตูุญ ุนูู
http://localhost/api/

# ุณุฌู ุฏุฎูู
# ุชุญูู ุฃู ุฃุฒุฑุงุฑ "ุชุณุฌูู ุฏุฎูู" ุงุฎุชูุช โ
```

### 2. ุงุฎุชุจุงุฑ ุงูุฏุฑุฏุดุฉ:
```bash
# ุฃุถู ูุญุงุฏุซุฉ ุชุฌุฑูุจูุฉ
http://localhost/api/api/test_add_conversation.php

# ุงูุชุญ ุตูุญุฉ ุงูุฑุณุงุฆู
http://localhost/api/messages.php

# ุฌุฑุจ ุฅุฑุณุงู:
# - ุฑุณุงูุฉ ูุตูุฉ ููุท โ
# - ุตูุฑุฉ ููุท โ
# - ุตูุฑุฉ + ูุต ูุนุงู โ
```

### 3. ุงุฎุชุจุงุฑ ููุญุฉ ุงูุฅุฏุงุฑุฉ:
```bash
# ุณุฌู ุฏุฎูู ูุฃุฏูู
# ุงูุชุญ ููุญุฉ ุงูุชุญูู
http://localhost/api/admin-dashboard.html

# ุฌุฑุจ Ban/Unban ูุณุชุฎุฏู โ
```

---

## ๐ ุงููุดุงูู ุงููุชุจููุฉ (ุฅู ูุฌุฏุช)

ูุง ุชูุฌุฏ ูุดุงูู ูุนุฑููุฉ ุญุงููุงู. ุฌููุน ุงููุธุงุฆู ุชุนูู ุจุดูู ุตุญูุญ.

---

## ๐ ุฅุญุตุงุฆูุงุช ุงูุชุบููุฑุงุช

- **ุนุฏุฏ ุงููููุงุช ุงููุนุฏูุฉ:** 6 ูููุงุช
- **ุนุฏุฏ ุงููููุงุช ุงูุฌุฏูุฏุฉ:** 4 ูููุงุช
- **ุฅุฌูุงูู ูุณุงุฑุงุช API ุงููุตูุญุฉ:** 10+ ููุถุน
- **ุฌุฏุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ:** 1 ุฌุฏูู (admin_chat_reads)
- **ุงูููุช ุงููุณุชุบุฑู:** ~2 ุณุงุนุฉ

---

## ๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

โ ุฃุฒุฑุงุฑ ุชุณุฌูู ุงูุฏุฎูู ุชุนูู ุจุดูู ุตุญูุญ
โ ุงูุฏุฑุฏุดุฉ ุชุนูู (ูุต + ุตูุฑ)
โ ุงููุญุงุฏุซุงุช ุงูุฅุฏุงุฑูุฉ ุชุนูู
โ ููุญุฉ ุงูุฅุฏุงุฑุฉ ุชุนูู
โ ุฌููุน ูุณุงุฑุงุช API ุตุญูุญุฉ
โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงููุฉ

---

## ๐จโ๐ป ููุงุญุธุงุช ูููุทูุฑ

### ููุท ูุณุงุฑุงุช API:
**ุงุณุชุฎุฏู ุฏุงุฆูุงู ูุณุงุฑุงุช ูุณุจูุฉ ุจุฏูู `/` ูู ุงูุจุฏุงูุฉ:**
```javascript
โ fetch('api/endpoint.php')      // ุตุญูุญ
โ fetch('/api/endpoint.php')     // ุฎุทุฃ
```

### ุณุจุจ ุงููุดููุฉ:
- ุงููุณุงุฑุงุช ุจู `/` ูู ุงูุจุฏุงูุฉ ุชุจุฏุฃ ูู ุฌุฐุฑ ุงูุฎุงุฏู
- ูุณุงุฑ ุงููุดุฑูุน: `C:\xampp\htdocs\api\`
- `/api/file.php` ูุจุญุซ ูู: `C:\xampp\htdocs\api\file.php` โ
- `api/file.php` ูุจุญุซ ูู: `C:\xampp\htdocs\api\api\file.php` โ

---

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
1. ุชุญูู ูู console ุงููุชุตูุญ (F12)
2. ุชุญูู ูู error log ูู PHP
3. ุฑุงุฌุน ูุฐุง ุงูููู ููุญููู

---

**ุขุฎุฑ ุชุญุฏูุซ:** 2025-10-10
**ุงูุฅุตุฏุงุฑ:** 1.0
**ุงูุญุงูุฉ:** โ ูุณุชูุฑ ูุฌุงูุฒ ููุฅูุชุงุฌ
